{"version":3,"sources":["recortarImage.js"],"names":["sharp","require","path","fs","recortarImageAvatar","req","res","next","file","imagePath","directorioPadre","dirname","rutaImagenRecortada","join","filename","resize","toFile","unlinkSync","module","exports"],"mappings":";;AAAA,IAAMA,KAAK,GAAGC,OAAO,CAAC,OAAD,CAArB;;AACA,IAAMC,IAAI,GAAGD,OAAO,CAAC,MAAD,CAApB;;AACA,IAAME,EAAE,GAAGF,OAAO,CAAC,IAAD,CAAlB;;AAGA,IAAMG,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,eAEhBF,GAAG,CAACG,IAFY;AAAA;AAAA;AAAA;;AAGVC,UAAAA,SAHU,GAGEJ,GAAG,CAACG,IAAJ,CAASN,IAHX;AAIVQ,UAAAA,eAJU,GAIQR,IAAI,CAACS,OAAL,CAAaF,SAAb,CAJR;AAKVG,UAAAA,mBALU,GAKYV,IAAI,CAACW,IAAL,CAAUH,eAAV,EAA2B,eAAeL,GAAG,CAACG,IAAJ,CAASM,QAAnD,CALZ;AAAA;AAAA,0CAOVd,KAAK,CAACS,SAAD,CAAL,CACDM,MADC,CACM,GADN,EACW,GADX,EAEDC,MAFC,CAEMJ,mBAFN,CAPU;;AAAA;AAWhB;AACAT,UAAAA,EAAE,CAACc,UAAH,CAAcR,SAAd,EAZgB,CAchB;;AACAJ,UAAAA,GAAG,CAACG,IAAJ,CAASN,IAAT,GAAgBU,mBAAhB;;AAfgB;AAiBpBL,UAAAA,IAAI;AAjBgB;AAAA;;AAAA;AAAA;AAAA;;AAoBpB,cAAIF,GAAG,CAACG,IAAR,EAAc;AACVL,YAAAA,EAAE,CAACc,UAAH,CAAcZ,GAAG,CAACG,IAAJ,CAASN,IAAvB;AACH;;AACDK,UAAAA,IAAI,aAAJ;;AAvBoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAA5B;;AA4BAW,MAAM,CAACC,OAAP,GAAiB;AACbf,EAAAA,mBAAmB,EAAnBA;AADa,CAAjB","sourcesContent":["const sharp = require(\"sharp\");\r\nconst path = require(\"path\");\r\nconst fs = require(\"fs\");\r\n\r\n\r\nconst recortarImageAvatar = async (req, res, next) => {\r\n    try {\r\n        if (req.file) {\r\n            const imagePath = req.file.path;\r\n            const directorioPadre = path.dirname(imagePath);\r\n            const rutaImagenRecortada = path.join(directorioPadre, 'recortada-' + req.file.filename);\r\n\r\n            await sharp(imagePath)\r\n                .resize(180, 180)\r\n                .toFile(rutaImagenRecortada)\r\n\r\n            //Elimina el archivo original\r\n            fs.unlinkSync(imagePath);\r\n\r\n            //Actualiza la ruta del archivo\r\n            req.file.path = rutaImagenRecortada;\r\n        }\r\n        next();\r\n\r\n    } catch (error) {\r\n        if (req.file) {\r\n            fs.unlinkSync(req.file.path);\r\n        }\r\n        next(error)\r\n    }\r\n};\r\n\r\n\r\nmodule.exports = {\r\n    recortarImageAvatar,\r\n}"],"file":"recortarImage.dev.js"}