{"version":3,"sources":["recortarImage.js"],"names":["sharp","require","path","recortarImageAvatar","req","res","next","imagePath","directorioPadre","rutaImagenRecortada","regeneratorRuntime","async","_context","prev","file","dirname","join","filename","awrap","resize","toFile","fs","unlinkSync","t0","stop","module","exports"],"mappings":"aAAA,IAAMA,MAAQC,QAAQ,SAChBC,KAAOD,QAAQ,QADfD,GAAKC,QAAU,MAKfE,oBAAsB,SAAOC,EAAKC,EAAKC,GAAjB,IAAAC,EAAAC,EAAAC,EAAA,OAAAC,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAN,MAAA,KAAA,EAAA,GAAAM,EAAAC,KAAA,EAEhBT,EAAIU,KAFY,OAAtBX,EAAsBC,EAAAU,KAAtBX,KAAsBK,EAAAN,KAAAa,QAAAR,GAAAE,EAAAP,KAAAc,KAAAR,EAAA,aAAAJ,EAAAU,KAAAG,UAAAL,EAAAN,KAAA,EAAAI,mBAAAQ,MAAAlB,MAAAO,GAAAY,OAAA,IAAA,KAAAC,OAAAX,IAAAG,EAAAN,KAAA,EAAA,MAAA,KAAA,EAAAe,GAAAC,WAAAf,GAehBH,EAAIU,KAAKZ,KAAOO,EAfA,KAAA,EAIVD,IAJUI,EAAAN,KAAA,GAAA,MAAA,KAAA,GAAAM,EAAAC,KAAA,GAAAD,EAAAW,GAAAX,EAAA,MAAA,GAAAR,EAAAU,MAqBhBO,GAAGC,WAAWlB,EAAIU,KAAKZ,MAVvBI,EAAAM,EAAAW,IAXgB,KAAA,GAAA,IAAA,MAAA,OAAAX,EAAAY,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA,OAAAC,OAAAC,QAAA,CAiBpBpB,oBAAAA","file":"recortarImage.min.js","sourcesContent":["const sharp = require(\"sharp\");\r\nconst path = require(\"path\");\r\nconst fs = require(\"fs\");\r\n\r\n\r\nconst recortarImageAvatar = async (req, res, next) => {\r\n    try {\r\n        if (req.file) {\r\n            const imagePath = req.file.path;\r\n            const directorioPadre = path.dirname(imagePath);\r\n            const rutaImagenRecortada = path.join(directorioPadre, 'recortada-' + req.file.filename);\r\n\r\n            await sharp(imagePath)\r\n                .resize(180, 180)\r\n                .toFile(rutaImagenRecortada)\r\n\r\n            //Elimina el archivo original\r\n            fs.unlinkSync(imagePath);\r\n\r\n            //Actualiza la ruta del archivo\r\n            req.file.path = rutaImagenRecortada;\r\n        }\r\n        next();\r\n\r\n    } catch (error) {\r\n        if (req.file) {\r\n            fs.unlinkSync(req.file.path);\r\n        }\r\n        next(error)\r\n    }\r\n};\r\n\r\n\r\nmodule.exports = {\r\n    recortarImageAvatar,\r\n}"]}